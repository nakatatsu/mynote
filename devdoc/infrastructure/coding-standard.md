# Coding Standard for Infrastructure

> **Note**: This file is auto-generated from `development_guideline.yaml`.
> Do not edit this file directly. Edit the YAML file instead and run `./generate-coding-standard.sh`.

## Directory Structure

* Infrastructure directory structure: infrastructure/ -> scripts/, terraform/ -> development/, production/, modules/ -> <module_name>/

```

infrastructure/

  scripts/

  terraform/

    development/

    production/

    modules/

      <module_name>/

```

## Style

* Implementation should consider the AWS Well-Architected Framework, though strict compliance is not required.
* Define calls to other modules in `main.tf`.
* Define variable blocks in `variables.tf`.
* Include descriptions in variable and output blocks.
* Include type definitions in variable blocks.
* Use variable blocks when parameter values differ between environments (e.g., production → CPU 4096, development → CPU 1024).
* Do not set default values in variable blocks.
* Do not use variable blocks unless strictly necessary. They may be used only when there are actual parameter differences between environments (e.g., development vs. production).
* Do not use variable blocks for values that remain the same across environments.
* Fixed values may be coded directly in resource definitions. (e.g., `t4g.micro`)
* Do not reference variable blocks as values in output blocks.
* Minimize the use of `locals` blocks. If used, define them in `locals.tf`.
* Minimize the use of `data` blocks. If used, place them immediately above the resource block that references them.
* The order of resource block attributes should be as follows: 1. If present, The count or for_each meta-argument, 2. Resource-specific non-block parameters, 3. Resource-specific block parameters, 4. If required, a lifecycle block, 5. If required, the depends_on parameter. No other constraints apply.
* The order of variable block attributes should be as follows: 1. Type, 2. Description, 3. Default (optional), 4. Sensitive (optional), 5. Validation blocks
* Avoid abbreviations, use full names (e.g., `cg` → `coding_guidelines`). However, abbreviations used as proper nouns (e.g., RDS, id) may be used.
* Do not use embedded attributes as much as possible. (e.g., `ingress`/`egress` within security groups)
* Keep comments in *.tf files to a minimum. Avoid adding header blocks or documentation-level specifications in comments.
* Do not add comments describing what is already clear from the code.

## Tags

* Common tags such as `Environment` and `Service` must be set only in `aws_default_tags`. Do not define them in any individual resource block.
* Always set Name tags for resources that use Name tags as identifiers.

## Tools

* Apply terraform fmt to all .tf files.
* Perform syntax validation with terraform validate.
* Introduce TFLint to detect AWS best practice violations and unused declarations.

## Naming Conventions

* Use snake_case for resource names in terraform code (e.g., web_server).
* A single resource within a module should be named `main` (e.g., `resource "aws_vpc" "main"`).
* Multiple resources within a module should be named according to their role (e.g., `primary`, `read_replica`).
* Do not use plural forms in resource names.
* Do not include the resource type name in the resource name (e.g., avoid `aws_instance.ec2_instance`).
* Include units in numerical variable names (e.g., `size_gb`, `ram_size_gb`).
* Use `MiB`/`GiB` for storage units, and `MB`/`GB` (decimal units) for others.
* Name boolean variables affirmatively (e.g., `enable_external_access`).
* Name AWS resource names (Name tags) in the format `[environment]-[project]([-additional_info_if_any])` (e.g., `production-practitioner-api`). In HCL, use variables like `${var.environment}-${var.project}-api`. 'api' is just an example, so be sure to replace it appropriately.

## Tfvars

* Place `terraform.tfvars.json` in the root module (the module where `terraform apply` is executed) instead of submodules.
* In the root module, ensure `terraform.tfvars.json` stores: 1) values that other modules might also reuse, 2) sensitive information that must never be hard-coded (e.g., private keys).

## Modules

* Do not include `provider` or `terraform` in submodules.

